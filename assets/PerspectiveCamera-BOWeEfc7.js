import{u as g,r as t,w as F,x as b,H as x,y as R,z as T,a as v,_ as w}from"./index-27h8v9Bg.js";function L(n,y,m){const f=g(r=>r.size),u=g(r=>r.viewport),c=typeof n=="number"?n:f.width*u.dpr,o=f.height*u.dpr,l=(typeof n=="number"?m:n)||{},{samples:i=0,depth:p,...s}=l,a=t.useMemo(()=>{const r=new F(c,o,{minFilter:b,magFilter:b,type:x,...s});return p&&(r.depthTexture=new R(c,o,T)),r.samples=i,r},[]);return t.useLayoutEffect(()=>{a.setSize(c,o),i&&(a.samples=i)},[i,a,c,o]),t.useEffect(()=>()=>a.dispose(),[]),a}const z=n=>typeof n=="function",C=t.forwardRef(({envMap:n,resolution:y=256,frames:m=1/0,makeDefault:f,children:u,...c},o)=>{const l=g(({set:e})=>e),i=g(({camera:e})=>e),p=g(({size:e})=>e),s=t.useRef(null);t.useImperativeHandle(o,()=>s.current,[]);const a=t.useRef(null),r=L(y);t.useLayoutEffect(()=>{c.manual||(s.current.aspect=p.width/p.height)},[p,c]),t.useLayoutEffect(()=>{s.current.updateProjectionMatrix()});let h=0,E=null;const d=z(u);return v(e=>{d&&(m===1/0||h<m)&&(a.current.visible=!1,e.gl.setRenderTarget(r),E=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,s.current),e.scene.background=E,e.gl.setRenderTarget(null),a.current.visible=!0,h++)}),t.useLayoutEffect(()=>{if(f){const e=i;return l(()=>({camera:s.current})),()=>l(()=>({camera:e}))}},[s,f,l]),t.createElement(t.Fragment,null,t.createElement("perspectiveCamera",w({ref:s},c),!d&&u),t.createElement("group",{ref:a},d&&u(r.texture)))});export{C as P};
